<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.futurenet.sorisoopbackend.billing.domain.BillingRepository">

    <select id="getCustomerKeyByMemberId" parameterType="long" resultType="string">
        SELECT CUSTOMER_KEY
        FROM MEMBER
        WHERE ID = #{memberId}
    </select>

    <update id="updateCustomerKey">
        UPDATE MEMBER
        SET CUSTOMER_KEY = #{customerKey},
            UPDATED_AT   = SYSDATE,
            UPDATED_BY   = #{memberId}
        WHERE ID = #{memberId}
    </update>

    <select id="getCustomerTokenByMemberId"
            resultType="com.futurenet.sorisoopbackend.billing.dto.response.CustomerTokenResponse">
        SELECT CUSTOMER_TOKEN as accessToken,
               REFRESH_TOKEN  as refreshToken,
               EXPIRES_AT     as expiresAt
        FROM BRAND_PAY_TOKEN
        WHERE MEMBER_ID = #{memberId}
    </select>

    <insert id="insertCustomerToken">
        INSERT INTO BRAND_PAY_TOKEN (MEMBER_ID, CUSTOMER_TOKEN, REFRESH_TOKEN, EXPIRES_AT, CREATED_AT)
        VALUES (#{memberId},
                #{token.accessToken},
                #{token.refreshToken},
                #{token.expiresAt},
                SYSDATE)
    </insert>

    <update id="updateCustomerToken">
        UPDATE BRAND_PAY_TOKEN
        SET CUSTOMER_TOKEN = #{token.accessToken},
            REFRESH_TOKEN  = #{token.refreshToken},
            EXPIRES_AT     = #{token.expiresAt}
        WHERE MEMBER_ID = #{memberId}
    </update>


</mapper>
